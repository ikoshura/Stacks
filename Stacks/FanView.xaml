<!-- FILE: Stacks/FanView.xaml -->
<ui:FluentWindow x:Class="Stacks.FanView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="clr-namespace:Stacks"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    mc:Ignorable="d"
    d:DataContext="{d:DesignInstance Type=local:FanView}"
    
    Title="FanView"
    SizeToContent="WidthAndHeight"
    WindowStyle="None"
    ShowInTaskbar="False"
    Topmost="True"
    ExtendsContentIntoTitleBar="True"
    WindowBackdropType="Mica"
    WindowCornerPreference="Round">

    <!-- Transparent supaya Mica jalan -->
    <ui:FluentWindow.Background>
        <SolidColorBrush Color="Transparent"/>
    </ui:FluentWindow.Background>

    <!-- Border semi-transparan supaya efek Mica kelihatan -->
    <Border x:Name="RootBorder"
            Background="Transparent"
            CornerRadius="8" 
            BorderThickness="1" 
            BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
            Padding="8">

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <ItemsControl x:Name="FileItemsControl" Grid.Row="0">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border x:Name="ItemBorder"
                                Background="Transparent"
                                CornerRadius="6"
                                Margin="4"
                                Padding="8"
                                Cursor="Hand"
                                MouseMove="File_MouseMove"
                                MouseLeftButtonUp="File_MouseLeftButtonUp">
                            <StackPanel HorizontalAlignment="Center">
                                <Border CornerRadius="6" Width="56" Height="56">
                                    <Border.Background>
                                        <ImageBrush ImageSource="{Binding Thumbnail}" Stretch="UniformToFill"/>
                                    </Border.Background>
                                </Border>
                                <ui:TextBlock Text="{Binding FileName}"
                                              Appearance="Secondary"
                                              TextTrimming="CharacterEllipsis"
                                              TextAlignment="Center"
                                              MaxWidth="70"
                                              Margin="0,6,0,0"
                                              FontSize="11"
                                              TextWrapping="Wrap"
                                              MaxHeight="30"/>
                            </StackPanel>
                        </Border>
                        <DataTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ItemBorder"
                                        Property="Background"
                                        Value="{DynamicResource ControlFillColorSecondaryBrush}"/>
                            </Trigger>
                        </DataTemplate.Triggers>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
                <ItemsControl.Style>
                    <Style TargetType="ItemsControl">
                        <Setter Property="ItemsPanel">
                            <Setter.Value>
                                <ItemsPanelTemplate>
                                    <UniformGrid Columns="5"/>
                                </ItemsPanelTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Source={x:Static local:SettingsManager.Current}, Path=Orientation}" Value="Vertical">
                                <Setter Property="ItemsPanel">
                                    <Setter.Value>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Vertical" HorizontalAlignment="Stretch" />
                                        </ItemsPanelTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ItemsControl.Style>
            </ItemsControl>

            <StackPanel Grid.Row="1" Margin="0,4,0,0">
                <Rectangle Height="1"
                           Fill="{DynamicResource ControlStrokeColorDefaultBrush}"
                           Margin="8,0,8,8"
                           Opacity="0.5"/>
                <ui:Button x:Name="OpenInExplorerButton"
                           Content="Open in File Explorer"
                           HorizontalAlignment="Stretch"
                           Margin="8,0,8,4"
                           Click="OpenInExplorerButton_Click"/>
                <ui:Button x:Name="CloseButton"
                           Content="Close"
                           Appearance="Secondary"
                           HorizontalAlignment="Stretch"
                           Margin="8,4,8,4"
                           Click="CloseButton_Click"/>
            </StackPanel>
        </Grid>
    </Border>
</ui:FluentWindow>